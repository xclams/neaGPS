Ext.ns("Curriki.module.addpath");Curriki.module.addpath.init=function(){if(Ext.isEmpty(Curriki.module.addpath.initialized)){var a=Curriki.module.addpath;
a.ie_size_shift=10;a.EnableNext=function(){Ext.getCmp("nextbutton").enable()};a.DisableNext=function(){Ext.getCmp("nextbutton").disable()
};a.RadioSelect=function(d,c){var b;var g=false;b=Ext.getCmp(d.value+"-entry-box");
if(b){if(b.isVisible()!=c){g=true;b.setVisible(c);b.setDisabled(!c)}}else{b=Ext.get(d.value+"-entry-box");
if(b&&b.isVisible()!=c){b.setVisibilityMode(Ext.Element.DISPLAY).setVisible(c)}}b=Ext.getCmp(d.value+"-entry-value");
if(g&&b){b.setDisabled(!c)}b=Ext.getCmp(d.value+"-container-cmp");if(g&&b){if(b.isVisible()!=c){b.setVisible(c);
b.setDisabled(!c)}}var f=Ext.getCmp(a.AddSourceDialogueId);if(f){f.doLayout();f.syncShadow()
}};a.AddSourceDialogueId="resource-source-dialogue";a.AddSource=Ext.extend(Curriki.ui.dialog.Actions,{initComponent:function(){Ext.apply(this,{title:_("add.contributemenu.title_addto_"+(this.toFolder?"composite":"site")),cls:"addpath addpath-source resource resource-add",id:a.AddSourceDialogueId,items:[{xtype:"panel",cls:"guidingquestion-container",items:[{xtype:"box",autoEl:{tag:"div",html:this.toFolder?_("add.contributemenu.guidingquestion_addto_composite",this.folderName):_("add.contributemenu.guidingquestion_addto_site"),cls:"guidingquestion"}}]},{xtype:"form",id:"addDialoguePanel",formId:"addDialogueForm",cls:"form-container",labelWidth:25,autoScroll:true,border:false,defaults:{labelSeparator:"",hideLabel:true,name:"assetSource"},bbar:["->",{text:_("add.contributemenu.cancel.button"),id:"cancelbutton",cls:"button cancel",listeners:{click:{fn:function(){this.close();
if(Curriki.current.cameFrom.endsWith("#startAdd")){Curriki.current.cameFrom=Curriki.current.cameFrom.substring(0,Curriki.current.cameFrom.length-"#startAdd".length)
}window.location.href=Curriki.current.cameFrom},scope:this}}},{text:_("add.contributemenu.next.button"),id:"nextbutton",cls:"button next",listeners:{click:{fn:function(){var c=this.findByType("form")[0].getForm();
var b=(c.getValues(false))["assetSource"];if(c.isValid()){a.SourceSelected(b,c.getValues(false))
}else{alert((_("add.contributemenu.required.fields.dialog_"+b)!=="add.contributemenu.required.fields.dialog_"+b)?_("add.contributemenu.required.fields.dialog_"+b):_("add.contributemenu.required.fields.dialog"))
}},scope:this}}}],monitorValid:true,listeners:{render:function(b){b.ownerCt.on("bodyresize",function(d,e,c){if(c==="auto"){b.setHeight("auto")
}else{b.setHeight(d.getInnerHeight()-(d.findByType("panel")[0].getBox().height+(Ext.isIE?a.ie_size_shift:0)))
}})}},items:[{xtype:"box",autoEl:{tag:"div",html:_("add.contributemenu.subtitle_have"),cls:"subtitle"}},{xtype:"radio",value:"file",inputValue:"file",boxLabel:_("add.contributemenu.option.file"),checked:true,listeners:{check:a.RadioSelect}},{xtype:"container",id:"file-container-cmp",autoEl:{tag:"div",id:"file-container",html:""},items:[{xtype:"textfield",inputType:"file",id:"file-entry-box",name:"filepath",allowBlank:false,preventMark:true,hideMode:"display",hideLabel:true,listeners:{focus:function(){var b=Ext.getCmp("file-entry-box").getValue();
var e=b.lastIndexOf("\\");var d=b.lastIndexOf("/");var c=(e>d)?e:d;b=b.substring(c+1);
Ext.getCmp("filename-entry-box").setValue(b)}}},{xtype:"textfield",id:"filename-entry-box",name:"filename",allowBlank:false,preventMark:true,hideLabel:true,hidden:true,disabled:true}]},{xtype:"radio",value:"video_upload",inputValue:"video_upload",boxLabel:_("add.contributemenu.option.video_upload"),listeners:{check:a.RadioSelect}},{xtype:"container",id:"video_upload-container-cmp",hidden:true,autoEl:{tag:"div",id:"video_upload-container",html:""},items:[{xtype:"textfield",inputType:"file",id:"video_upload-entry-box",name:"upload[file]",allowBlank:false,preventMark:true,hideMode:"display",hideLabel:true,hidden:true,disabled:true,listeners:{focus:function(){}}}]},{xtype:"radio",value:"link",inputValue:"link",boxLabel:_("add.contributemenu.option.link"),listeners:{check:a.RadioSelect}},{xtype:"container",id:"link-container-cmp",hidden:true,autoEl:{tag:"div",id:"link-container",html:""},items:[{xtype:"textfield",id:"link-entry-box",name:"link",value:"http://",disabled:true,hidden:true,allowBlank:false,preventMark:true,hideMode:"display",hideLabel:true,vtype:"url"}]},{xtype:"radio",value:"repository",inputValue:"repository",boxLabel:_("add.contributemenu.option.repository"),hidden:true||!this.toFolder,hideLabel:true||!this.toFolder,hideParent:true},{xtype:"box",autoEl:{tag:"div",html:_("add.contributemenu.subtitle_make"),cls:"subtitle"}},{xtype:"radio",value:"scratch",inputValue:"scratch",boxLabel:_("add.contributemenu.option.scratch")},{xtype:"radio",value:"folder",inputValue:"folder",boxLabel:_("add.contributemenu.option.folder"),hidden:!this.toFolder,hideParent:true}]}]});
a.AddSource.superclass.initComponent.call(this)}});Ext.reg("apSource",a.AddSource);
a.TemplateList=function(){var e="add.select"+Curriki.current.templateType;var d=[];
var c=1;while(_(e+".list"+c+".header")!==e+".list"+c+".header"){var b=[];b.push({xtype:"radio",name:"templateName",value:"list"+c,checked:(c===1?true:false),boxLabel:_(e+".list"+c+".header"),listeners:{check:a.TemplateSelect}});
b.push({xtype:"box",autoEl:{tag:"div",html:_(e+".list"+c+".description"),cls:"description"}});
d.push({xtype:"container",id:"selecttemplate-list"+c,items:b,autoEl:{tag:"div",id:"selecttemplate-list"+c+"-box",html:""}});
++c}Curriki.current.submitToTemplate=_(e+".list1.url");return d};a.TemplateSelect=function(c,d){var e="add.select"+Curriki.current.templateType;
if(d){var b=Ext.get("selecttemplate-thumbnail-image");if(!Ext.isEmpty(b)){b.set({src:_(e+"."+c.value+".thumbnail")});
Curriki.current.submitToTemplate=_(e+"."+c.value+".url")}}};a.SelectTemplate=Ext.extend(Curriki.ui.dialog.Actions,{initComponent:function(){var b="add.select"+Curriki.current.templateType;
var c=(Curriki.current.templateType==="format")?"Format":"Template";Ext.apply(this,{id:"SelectTemplateDialogueWindow",title:_(b+".title"),cls:"addpath addpath-templates resource resource-add",border:false,bodyBorder:false,items:[{xtype:"box",autoEl:{tag:"div",html:_(b+".guidingquestion"),cls:"guidingquestion"}},{xtype:"box",hidden:!(Curriki.current.templateType=="format"),autoEl:{tag:"div",html:_("add.selectformat.instruction"),cls:"instructionTxt",hidden:!(Curriki.current.templateType=="format")}},{xtype:"form",id:"SelectTemplateDialoguePanel",formId:"Select"+c+"DialogueForm",border:false,bodyBorder:false,labelWidth:25,defaults:{labelSeparator:"",border:false,bodyBorder:false},buttonAlign:"right",buttons:[{text:_(b+".cancel.button"),id:"cancelbutton",cls:"button cancel",listeners:{click:function(f,d){Ext.getCmp(f.id).ownerCt.ownerCt.close();
window.location.href=Curriki.current.cameFrom}}},{text:_(b+".next.button"),id:"nextbutton",cls:"button next",listeners:{click:function(f,d){a.PostToTemplate(Curriki.current.submitToTemplate);
Ext.getCmp(f.id).ownerCt.ownerCt.close()}}}],items:[{id:"selecttemplate-form-container",layout:"column",defaults:{border:false},items:[{columnWidth:0.55,items:[{xtype:"container",id:"selecttemplate-list",items:a.TemplateList(),autoEl:{tag:"div",id:"selecttemplate-list-box",html:""}}]},{columnWidth:0.35,items:[{xtype:"box",id:"selecttemplate-thumbnail-container",anchor:"",autoEl:{tag:"div",id:"selecttemplate-thumbnail",style:"margin:8px 0 8px 10px",children:[{tag:"img",id:"selecttemplate-thumbnail-image",src:_(b+".list1.thumbnail"),onLoad:"Ext.getCmp('SelectTemplateDialogueWindow').syncShadow();"}]}}]}]}]}]});
a.SelectTemplate.superclass.initComponent.call(this)}});Ext.reg("apSelectTemplate",a.SelectTemplate);
a.Metadata1=Ext.extend(Curriki.ui.dialog.Actions,{initComponent:function(){Ext.apply(this,{title:_("add.setrequiredinfo.part1.title"),cls:"addpath addpath-metadata resource resource-add",items:[{xtype:"panel",cls:"guidingquestion-container",items:[{xtype:"box",autoEl:{tag:"div",html:_("add.setrequiredinfo.part1.guidingquestion"),cls:"guidingquestion"}},{xtype:"box",autoEl:{tag:"div",html:_("form.required.fields.instruction"),cls:"instruction"}}]},{xtype:"form",id:"MetadataDialoguePanel",formId:"MetadataDialogueForm",labelWidth:25,autoScroll:true,border:false,defaults:{labelSeparator:""},bbar:["->",{text:_("add.setrequiredinfo.part1.cancel.button"),id:"cancelbutton",cls:"button cancel",listeners:{click:{fn:function(){this.close();
window.location.href=Curriki.current.cameFrom},scope:this}}},{text:_("add.setrequiredinfo.part1.next.button"),id:"nextbutton",cls:"button next",listeners:{click:{fn:function(){var c=this.findByType("form")[0].getForm();
if(c.isValid()){Curriki.current.sri1=c.getValues(false);Curriki.current.sri1.fw_items=this.findByType("treepanel")[0].getChecked("id");
this.close();var d=Ext.ComponentMgr.create({xtype:"apSRI2"});d.show();Ext.ComponentMgr.register(d)
}else{var b={msg:_("form.scratch.required.fields.dialog"),invalid:0,form:c};Ext.each(["title","description","subject","level","ict"],function(e){var f=null;
switch(e){case"title":case"description":case"ict":if(!this.form.findField(e).isValid()){f=e
}break;case"subject":if(!this.form.findField("fw_items-validation").isValid()){f=e
}break;case"level":if(!this.form.findField("educational_level2-validation").isValid()){f=e
}break;default:break}var g=Ext.get("metadata-"+e+"-title");if(Ext.isEmpty(g)){switch(f){case"ict":g=Ext.get("metadata-instructional_component2-title");
break;case"subject":g=Ext.get("metadata-fw_items-title");break;case"level":g=Ext.get("metadata-educational_level2-title");
break}}if(!Ext.isEmpty(f)){this.msg=this.msg+"\n\t"+_("form.scratch.required.fields.dialog."+e);
if(g){g.addClass("metadata-title-field-invalid")}this.invalid++}else{if(g){g.removeClass("metadata-title-field-invalid")
}}},b);if(b.invalid>0){alert(b.msg)}}},scope:this}}}],monitorValid:true,listeners:{render:function(b){b.ownerCt.on("bodyresize",function(d,e,c){if(c==="auto"){b.setHeight("auto")
}else{b.setHeight(d.getInnerHeight()-(d.findByType("panel")[0].getBox().height+(Ext.isIE?a.ie_size_shift:0)))
}})}},items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-title",cls:"information-header information-header-required",children:[{tag:"em",id:"metadata-title-required",cls:"required-indicator",html:_("form.required.fields.indicator")},{tag:"span",id:"metadata-title-title",cls:"metadata-title",html:_("sri.title_title")},{tag:"img",id:"metadata-title-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.title_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.title_txt"),cls:"directions"}},{xtype:"textfield",id:"metadata-title-entry",name:"title",emptyText:_("sri.title_content"),allowBlank:false,preventMark:true,hideLabel:true,width:"80%"},{xtype:"box",autoEl:{tag:"div",id:"metadata-description",cls:"information-header information-header-required",children:[{tag:"em",id:"metadata-description-required",cls:"required-indicator",html:_("form.required.fields.indicator")},{tag:"span",id:"metadata-description-title",cls:"metadata-title",html:_("sri.description_title")},{tag:"img",id:"metadata-description-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.description_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.description_txt"),cls:"directions"}},{xtype:"textarea",id:"metadata-description-entry",name:"description",emptyText:_("sri.description.empty_msg"),allowBlank:false,preventMark:true,hideLabel:true,width:"80%"},{layout:"column",border:false,defaults:{border:false},items:[{columnWidth:0.5,items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-fw_items",cls:"information-header information-header-required",children:[{tag:"em",id:"metadata-fw_items-required",cls:"required-indicator",html:_("form.required.fields.indicator")},{tag:"span",id:"metadata-fw_items-title",cls:"metadata-title",html:_("sri.fw_items_title")},{tag:"img",id:"metadata-fw_items-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.fw_items_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.fw_items_txt"),cls:"directions"}},{xtype:"numberfield",id:"fw_items-validation",allowBlank:false,preventMark:true,minValue:1,hidden:true,listeners:{valid:function(c){if(!this.rendered||this.preventMark){return
}var b=Ext.getCmp("fw_items-tree");b.removeClass("x-form-invalid");b.el.dom.qtip=""
},invalid:function(c,e){if(!this.rendered||this.preventMark){return}var b=Ext.getCmp("fw_items-tree");
b.addClass("x-form-invalid");var d=c.invalidText;b.el.dom.qtip=d;b.el.dom.qclass="x-form-invalid-tip";
if(Ext.QuickTips){Ext.QuickTips.enable()}}}},(function(){var b=0;var d=Curriki.current.metadata;
if(d){var c=d.fw_items;Ext.isArray(c)&&(function(e){var f=arguments.callee;Ext.each(e,function(g){if(g.id){if(g.checked=(c.indexOf(g.id)!==-1)){b++
}if(g.children){f(g.children)}}})})(Curriki.data.fw_item.fwChildren)}return Ext.apply(a.fwTree=Curriki.ui.component.asset.getFwTree(),{listeners:{render:function(e){e.findParentByType("apSRI1").on("show",function(){Ext.getCmp("fw_items-validation").setValue(b)
})}}})})()]},{columnWidth:0.5,items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-educational_level2",cls:"information-header information-header-required",children:[{tag:"em",id:"metadata-educational_level2-required",cls:"required-indicator",html:_("form.required.fields.indicator")},{tag:"span",id:"metadata-educational_level2-title",cls:"metadata-title",html:_("sri.educational_level2_title")},{tag:"img",id:"metadata-educational_level2-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.educational_level2_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.educational_level2_txt"),cls:"directions"}},{xtype:"numberfield",id:"educational_level2-validation",allowBlank:false,preventMark:true,minValue:1,invalidText:"TRANSLATE: This field is required",hidden:true,listeners:{valid:function(c){var b=Ext.getCmp("educational_level2-set");
b.removeClass("x-form-invalid");b.el.dom.qtip=""},invalid:function(c,e){var b=Ext.getCmp("educational_level2-set");
b.addClass("x-form-invalid");var d=c.invalidText;b.el.dom.qtip=d;b.el.dom.qclass="x-form-invalid-tip";
if(Ext.QuickTips){Ext.QuickTips.enable()}},render:function(b){b.findParentByType("apSRI1").on("show",function(){if(!Ext.isEmpty(Curriki.current.metadata)){var c=Curriki.current.metadata;
if(!Ext.isEmpty(c.educational_level)&&Ext.isArray(c.educational_level)){c.educational_level.each(function(d){Ext.getCmp(Ext.select('input[type="checkbox"][name="educational_level2"][value="'+d+'"]').first().dom.id).setValue(true)
})}}})}}},{xtype:"fieldset",id:"educational_level2-set",border:false,autoHeight:true,preventMark:true,defaults:{xtype:"checkbox",name:"educational_level2",hideLabel:true,labelSeparator:"",listeners:{check:function(d,c){var b=Ext.getCmp("educational_level2-validation");
b.setValue(b.getValue()+(c?1:-1))}}},items:Curriki.data.el.data}]}]},{border:false,items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-keywords",cls:"information-header",children:[{tag:"span",id:"metadata-keywords-title",cls:"metadata-title",html:_("sri.keywords_title")},{tag:"img",id:"metadata-keywords-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.keywords_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.keywords_txt"),cls:"directions"}},{xtype:"textfield",id:"metadata-keywords-entry",name:"keywords",emptyText:_("sri.keywords.empty_msg"),hideLabel:true,listeners:{render:function(b){b.findParentByType("apSRI1").on("show",function(){if(!Ext.isEmpty(Curriki.current.metadata)){var c=Curriki.current.metadata;
if(!Ext.isEmpty(c.keywords)){if(Ext.isArray(c.keywords)){c.keywords=c.keywords.join(" ")
}Ext.getCmp("metadata-keywords-entry").setValue(c.keywords)}}})}}}]},{xtype:"box",autoEl:{tag:"div",id:"metadata-instructional_component2",cls:"information-header information-header-required",children:[{tag:"em",id:"metadata-instructional_component2-required",cls:"required-indicator",html:_("form.required.fields.indicator")},{tag:"span",id:"metadata-instructional_component2-title",cls:"metadata-title",html:_("sri.instructional_component2_title")},{tag:"img",id:"metadata-instructional_component2-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.instructional_component2_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.instructional_component2_txt"),cls:"directions"}},{xtype:"multiselect",name:"ict",hideLabel:true,enableToolbar:false,legend:" ",store:Curriki.data.ict.store,valueField:"id",displayField:"ict",width:250,height:100,allowBlank:false,preventMark:true,minLength:1,isFormField:true}]}]});
a.Metadata1.superclass.initComponent.call(this)}});Ext.reg("apSRI1",a.Metadata1);
a.Metadata2=Ext.extend(Curriki.ui.dialog.Actions,{initComponent:function(){Ext.apply(this,{id:"MetadataDialogueWindow",title:_("add.setrequiredinfo.part2.title"),cls:"addpath addpath-metadata resource resource-add",items:[{xtype:"panel",cls:"guidingquestion-container",items:[{xtype:"box",autoEl:{tag:"div",html:_("add.setrequiredinfo.part2.guidingquestion"),cls:"guidingquestion"}},{xtype:"box",autoEl:{tag:"div",html:_("form.required.fields.instruction"),cls:"instruction"}}]},{xtype:"form",id:"MetadataDialoguePanel",formId:"MetadataDialogueForm",labelWidth:25,autoScroll:true,border:false,defaults:{labelSeparator:""},bbar:["->",{text:_("add.setrequiredinfo.part2.cancel.button"),id:"cancelbutton",cls:"button cancel",listeners:{click:function(c,b){Ext.WindowMgr.get("MetadataDialogueWindow").close();
window.location.href=Curriki.current.cameFrom}}},{text:_("add.setrequiredinfo.part2.next.button"),id:"nextbutton",cls:"button next",listeners:{click:{fn:function(){var c=this.findByType("form")[0].getForm();
if(c.isValid()){Curriki.current.sri2=c.getValues(false);this.close();a.MetadataFinished()
}else{var b={msg:_("form.scratch.required.fields.dialog"),invalid:0,form:c};Ext.each(["rights"],function(d){var e=null;
switch(d){case"rights":if(!this.form.findField("right_holder").isValid()){e=d}break;
default:break}var f=Ext.get("metadata-"+d+"-title");if(Ext.isEmpty(f)){switch(e){case"rights":f=Ext.get("metadata-rights_holder-title");
break}}if(!Ext.isEmpty(e)){this.msg=this.msg+"\n\t"+_("form.scratch.required.fields.dialog."+d);
if(f){f.addClass("metadata-title-field-invalid")}this.invalid++}else{if(f){f.removeClass("metadata-title-field-invalid")
}}},b);if(b.invalid>0){alert(b.msg)}}},scope:this}}}],monitorValid:true,listeners:{render:function(b){b.ownerCt.on("bodyresize",function(d,e,c){if(c==="auto"){b.setHeight("auto")
}else{b.setHeight(d.getInnerHeight()-(d.findByType("panel")[0].getBox().height+(Ext.isIE?a.ie_size_shift:0)))
}})}},items:[{border:false,items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-rights",cls:"information-header",children:[{tag:"span",id:"metadata-rights-title",cls:"metadata-title",html:_("sri.rights_title")},{tag:"img",id:"metadata-rights-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.rights_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.rights_txt"),cls:"directions"}},{border:false,xtype:"radiogroup",width:"90%",columns:[0.95],vertical:true,defaults:{name:"rights"},items:Curriki.data.rights.data,listeners:{render:function(b){b.findParentByType("apSRI2").on("show",function(){if(!Ext.isEmpty(Curriki.current.metadata)){var c=Curriki.current.metadata;
if(!Ext.isEmpty(c.rights)){Ext.getCmp(Ext.select('input[type="radio"][name="rights"][value="'+c.rights+'"]').first().dom.id).setValue(c.rights)
}}})}}}]},{border:false,items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-hidden_from_search",cls:"information-header",children:[{tag:"span",id:"metadata-hidden_from_search-title",cls:"metadata-title",html:_("sri.hidden_from_search_title")},{tag:"img",id:"metadata-hidden_from_search-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.hidden_from_search_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.hidden_from_search_txt"),cls:"directions"}},{xtype:"checkbox",name:"hidden_from_search",boxLabel:_("sri.hidden_from_search_after")}]},{border:false,items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-language",cls:"information-header",children:[{tag:"span",id:"metadata-language-title",cls:"metadata-title",html:_("sri.language_title")},{tag:"img",id:"metadata-language-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.language_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.language_txt"),cls:"directions"}},{xtype:"combo",id:"metadata-language-entry",hiddenName:"language",hideLabel:true,width:"60%",mode:"local",store:Curriki.data.language.store,displayField:"language",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("sri.language_empty_msg"),selectOnFocus:true,forceSelection:true,value:Curriki.data.language.initial?Curriki.data.language.initial:undefined,listeners:{render:function(b){b.findParentByType("apSRI2").on("show",function(){if(!Ext.isEmpty(Curriki.current.metadata)){var c=Curriki.current.metadata;
if(!Ext.isEmpty(c.language)){Ext.getCmp("metadata-language-entry").setValue(c.language)
}}})}}}]},{border:false,items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-right_holder",cls:"information-header information-header-required",children:[{tag:"em",id:"metadata-title-required",cls:"required-indicator",html:_("form.required.fields.indicator")},{tag:"span",id:"metadata-right_holder-title",cls:"metadata-title",html:_("sri.right_holder_title")},{tag:"img",id:"metadata-right_holder-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.right_holder_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.right_holder_txt"),cls:"directions"}},{xtype:"textfield",id:"metadata-right_holder-entry",name:"right_holder",hideLabel:true,value:Curriki.data.user.me.fullname,allowBlank:false,preventMark:true,width:"60%",listeners:{render:function(b){b.findParentByType("apSRI2").on("show",function(){if(!Ext.isEmpty(Curriki.current.metadata)){var c=Curriki.current.metadata;
if(!Ext.isEmpty(c.rightsHolder)){Ext.getCmp("metadata-right_holder-entry").setValue(c.rightsHolder)
}}})}}}]},{border:false,items:[{xtype:"box",autoEl:{tag:"div",id:"metadata-license_type",cls:"information-header",children:[{tag:"span",id:"metadata-license_type-title",cls:"metadata-title",html:_("sri.license_type_title")},{tag:"img",id:"metadata-license_type-info",cls:"metadata-tooltip",src:Curriki.ui.InfoImg,qtip:_("sri.license_type_tooltip")}]}},{xtype:"box",autoEl:{tag:"div",html:_("sri.license_type_txt"),cls:"directions"}},{xtype:"box",autoEl:{tag:"div",html:_("sri.license_type_heading")}},{xtype:"combo",id:"metadata-license_type-entry",hiddenName:"license_type",hideLabel:true,width:"75%",mode:"local",store:Curriki.data.licence.store,displayField:"licence",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("sri.license_type_empty_msg"),selectOnFocus:true,forceSelection:true,value:Curriki.data.licence.initial?Curriki.data.licence.initial:undefined,listeners:{render:function(b){b.findParentByType("apSRI2").on("show",function(){if(!Ext.isEmpty(Curriki.current.metadata)){var c=Curriki.current.metadata;
if(!Ext.isEmpty(c.licenseType)){Ext.getCmp("metadata-license_type-entry").setValue(c.licenseType)
}}})}}}]},{border:false,items:[{xtype:"checkbox",name:"grantCurrikiCommercialLicense",boxLabel:_("sri.license_type_license_to_curriki"),checked:true,id:"metadata-grantCurrikiCommercialLicense-entry",listeners:{render:function(b){b.findParentByType("apSRI2").on("show",function(){if(!Ext.isEmpty(Curriki.current.metadata)){var c=Curriki.current.metadata;
if(!Ext.isEmpty(c.grantCurrikiCommercialLicense)&&c.grantCurrikiCommercialLicense=="off"){Ext.getCmp("metadata-grantCurrikiCommercialLicense-entry").setVisible(false);
Ext.getCmp("metadata-grantCurrikiCommercialLicense-entry").originalValue=false;Ext.getCmp("metadata-grantCurrikiCommercialLicense-entry").setValue(false)
}}})}}}]}]}]});a.Metadata2.superclass.initComponent.call(this)}});Ext.reg("apSRI2",a.Metadata2);
a.MetadataFinished=function(){if("string"===typeof Curriki.current.sri1.ict){Curriki.current.sri1.ict=Curriki.current.sri1.ict.split(",")
}if("string"===typeof Curriki.current.sri1.educational_level2){Curriki.current.sri1.educational_level2=Curriki.current.sri1.educational_level2.split(",")
}if("undefined"==typeof(Curriki.current.sri2.grantCurrikiCommercialLicense)){Curriki.current.sri2.grantCurrikiCommercialLicense="off"
}var b=Curriki.current.sri1;Ext.apply(b,Curriki.current.sri2);Curriki.assets.SetMetadata(Curriki.current.asset.assetPage,b,function(c){console.log("SetMD CB: ",c);
Curriki.assets.Publish(Curriki.current.asset.assetPage,Curriki.current.publishSpace,function(d){console.log("Published CB: ",d);
Curriki.current.assetName=d.assetPage;Curriki.current.asset.assetPage=d.assetPage;
Curriki.current.asset.assetType=d.assetType;Curriki.current.asset.fullAssetType=d.fullAssetType;
Curriki.current.asset.title=d.title;Curriki.current.asset.description=d.description;
if(Curriki.current.parentAsset){Curriki.assets.CreateSubasset(Curriki.current.parentAsset,Curriki.current.assetName,(Curriki.current.drop&&(("undefined"!=typeof Curriki.current.drop.targetIndex)?Curriki.current.drop.targetIndex:-1)),a.ShowDone())
}else{a.ShowDone()}})})};a.FinalLink=function(g){var e,f,d,b,c;f=_("add.finalmessage."+g+".link");
b=(Curriki.current.asset&&Curriki.current.asset.assetPage)||Curriki.current.assetName;
c=false;switch(g){case"view":e="/xwiki/bin/view/"+b.replace(".","/");break;case"add":if(true||Curriki.data.user.collectionChildren.length>0||Curriki.data.user.groupChildren.length>0){d=function(j,h){Curriki.current.flow="E";
Curriki.ui.show("apLocation");var k=Ext.getCmp("done-dialogue");if(k){k.close()}}
}else{c=true}break;case"viewtarget":e="/xwiki/bin/view/"+b.replace(".","/");f=_("add.finalmessage.viewtarget.link",(Curriki.current.assetTitle||(Curriki.current.sri1&&Curriki.current.sri1.title)||(Curriki.current.asset&&Curriki.current.asset.title)||"UNKNOWN"));
break;case"continue":e=Curriki.current.cameFrom;break;case"contributions":e="/xwiki/bin/view/MyCurriki/Contributions";
break;case"collections":e="/xwiki/bin/view/MyCurriki/Collections";break;case"favorites":e="/xwiki/bin/view/MyCurriki/Favorites";
break;case"close":e=Curriki.current.cameFrom;break}if(!d){d=function(j,h){window.location.href=e
}}return{text:f,cls:"button link",handler:d,hidden:c}};a.DoneMessage=function(b){var c;
switch(Curriki.current.flow){case"E":case"H":case"J":case"P":case"F":case"N":case"L":case"FFolder":case"NFolder":case"LFolder":var d=[Curriki.current.assetTitle||(Curriki.current.sri1&&Curriki.current.sri1.title)||(Curriki.current.asset&&Curriki.current.asset.title)||"UNKNOWN",Curriki.current.parentTitle||"UNKNOWN"];
c="<p>"+_("add.finalmessage.text_"+b+"_success",d)+"</p>";break;case"Copy":var d=[Curriki.current.copyOfTitle||"UNKNOWN",Curriki.current.assetTitle||(Curriki.current.sri1&&Curriki.current.sri1.title)||(Curriki.current.asset&&Curriki.current.asset.title)||"UNKNOWN"];
c="<p>"+_("add.finalmessage.text_"+b+"_success",d)+"</p>";break;case"Copy2":var d=[Curriki.current.copyOfTitle||"UNKNOWN",Curriki.current.assetTitle||(Curriki.current.sri1&&Curriki.current.sri1.title)||(Curriki.current.asset&&Curriki.current.asset.title)||"UNKNOWN",Curriki.current.parentTitle||"UNKNOWN"];
c="<p>"+_("add.finalmessage.text_"+b+"_success",d)+"</p>";break;default:c="<p>"+_("add.finalmessage.text_"+b+"_success")+"</p>";
break}switch(Curriki.current.flow){case"K":case"M":c+=_("add.finalmessage.text_"+b+"_tip1");
break}return{xtype:"box",autoEl:{tag:"div",cls:"done-message",html:c}}};a.CloseDone=function(b){return{text:_("add.finalmessage.close.button"),id:"closebutton",listeners:{click:{fn:function(d,c){this.close();
if(!Ext.isEmpty(Curriki.current.cameFrom)){window.location.href=Curriki.current.cameFrom
}},scope:b}}}};a.DoneA=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_resource"),cls:"addpath addpath-done resource resource-add",bbar:[a.FinalLink("view"),"-",a.FinalLink("add"),"-",a.FinalLink("contributions"),"->",a.CloseDone(this)],items:[a.DoneMessage("resource")]});
a.DoneA.superclass.initComponent.call(this)}});Ext.reg("apDoneA",a.DoneA);Ext.reg("apDoneB",a.DoneA);
Ext.reg("apDoneD",a.DoneA);Ext.reg("apDoneR",a.DoneA);a.DoneC=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_collection"),cls:"addpath addpath-done resource resource-add",bbar:[a.FinalLink("collections"),"->",a.CloseDone(this)],items:[a.DoneMessage("collection")]});
a.DoneC.superclass.initComponent.call(this)}});Ext.reg("apDoneC",a.DoneC);a.DoneE=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_successful"),cls:"addpath addpath-done resource resource-add",bbar:["->",a.CloseDone(this)],items:[a.DoneMessage("addto")]});
a.DoneE.superclass.initComponent.call(this)}});Ext.reg("apDoneE",a.DoneE);Ext.reg("apDoneH",a.DoneE);
Ext.reg("apDoneJ",a.DoneE);Ext.reg("apDoneP",a.DoneE);a.DoneF=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_successful"),cls:"addpath addpath-done resource resource-add",bbar:["->",a.CloseDone(this)],items:[a.DoneMessage("addto")]});
a.DoneF.superclass.initComponent.call(this)}});Ext.reg("apDoneF",a.DoneF);Ext.reg("apDoneN",a.DoneF);
Ext.reg("apDoneL",a.DoneF);a.DoneFFolder=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_folder"),cls:"addpath addpath-done resource resource-add",bbar:["->",a.CloseDone(this)],items:[a.DoneMessage("addto_folder")]});
a.DoneFFolder.superclass.initComponent.call(this)}});Ext.reg("apDoneFFolder",a.DoneFFolder);
Ext.reg("apDoneNFolder",a.DoneFFolder);Ext.reg("apDoneLFolder",a.DoneFFolder);a.DoneG=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_successful"),cls:"addpath addpath-done resource resource-add",bbar:[a.FinalLink("favorites"),"->",a.CloseDone(this)],items:[a.DoneMessage("favorites")]});
a.DoneG.superclass.initComponent.call(this)}});Ext.reg("apDoneG",a.DoneG);a.DoneK=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_collection"),cls:"addpath addpath-done resource resource-add",bbar:["->",a.CloseDone(this)],items:[a.DoneMessage("collection")]});
a.DoneK.superclass.initComponent.call(this)}});Ext.reg("apDoneK",a.DoneK);a.DoneM=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_collection"),cls:"addpath addpath-done resource resource-add",bbar:["->",a.CloseDone(this)],items:[a.DoneMessage("groupcollection")]});
a.DoneM.superclass.initComponent.call(this)}});Ext.reg("apDoneM",a.DoneM);a.DoneI=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_resource"),cls:"addpath addpath-done resource resource-add",bbar:[a.FinalLink("view"),"-",a.FinalLink("add"),"->",a.CloseDone(this)],items:[a.DoneMessage("resource_simple")]});
a.DoneI.superclass.initComponent.call(this)}});Ext.reg("apDoneI",a.DoneI);Ext.reg("apDoneO",a.DoneI);
a.DoneCopy=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_copied"),cls:"addpath addpath-done resource resource-add",bbar:[a.FinalLink("view"),"-",a.FinalLink("add"),"-",a.FinalLink("contributions"),"->",a.CloseDone(this)],items:[a.DoneMessage("copy")]});
a.DoneCopy.superclass.initComponent.call(this)}});Ext.reg("apDoneCopy",a.DoneCopy);
a.DoneCopy2=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){Ext.apply(this,{title:_("add.finalmessage.title_copiedtolocation"),cls:"addpath addpath-done resource resource-add",bbar:[a.FinalLink("view"),"->",a.CloseDone(this)],items:[a.DoneMessage("copiedtolocation")]});
a.DoneCopy2.superclass.initComponent.call(this)}});Ext.reg("apDoneCopy2",a.DoneCopy2);
a.ShowDone=function(){if(Ext.isEmpty(Curriki.current.flow)){return}var b=(Curriki.current.asset&&Curriki.current.asset.assetPage)||Curriki.current.assetName;
Curriki.logView("/features/resources/add/"+Curriki.current.flow+Curriki.current.flowFolder+"/"+((Curriki.current.asset&&Curriki.current.asset.assetType)||Curriki.current.assetType||"UNKNOWN")+"/"+b.replace(".","/"));
var c=function(){var d=Ext.ComponentMgr.create({xtype:"apDone"+Curriki.current.flow+Curriki.current.flowFolder,id:"done-dialogue"});
d.show();Ext.ComponentMgr.register(d)};Ext.ns("Curriki.settings");Curriki.settings.localCollectionFetch=true;
switch(Curriki.current.flow){case"A":case"B":case"D":case"R":case"I":case"O":case"Copy":Curriki.init(function(){c()
});break;default:Curriki.init(function(){c()});break}};a.ChooseLocation=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){var b=[];
b.push({text:_("panels.myCurriki.myCollections"),id:"ctv-drop-tree-collection-root",cls:"ctv-top ctv-header ctv-collections",leaf:false,allowDrag:false,allowDrop:true,disallowDropping:true,expanded:false,currikiNodeType:"myCollections"});
b.push({text:_("panels.myCurriki.myGroups"),id:"ctv-drop-tree-group-root",cls:"ctv-top ctv-header ctv-groups",leaf:false,allowDrag:false,allowDrop:true,disallowDropping:true,expanded:false,currikiNodeType:"myGroups"});
Ext.apply(this,{id:"ChooseLocationDialogueWindow",title:_("add.chooselocation.title"),cls:"addpath addpath-ctv resource resource-add",autoScroll:false,width:634,items:[{xtype:"panel",id:"guidingquestion-container",cls:"guidingquestion-container",items:[{xtype:"box",autoEl:{tag:"div",html:_("add.chooselocation.guidingquestion"),cls:"guidingquestion"}},{xtype:"box",autoEl:{tag:"div",html:_("add.chooselocation.instruction"),cls:"instruction"}}]},{xtype:"form",id:"ChooseLocationDialoguePanel",formId:"ChooseLocationDialogueForm",labelWidth:25,autoScroll:false,border:false,defaults:{labelSeparator:""},bbar:["->",{text:_("add.chooselocation.cancel.button"),id:"cancelbutton",cls:"button cancel",listeners:{click:{fn:function(){this.close();
window.location.href=Curriki.current.cameFrom},scope:this}}},{text:_("add.chooselocation.next.button"),id:"nextbutton",cls:"button next",disabled:true,listeners:{click:{fn:function(){a.AddSubasset(function(){var c=Ext.getCmp("ChooseLocationDialogueWindow");
if(c){c.close()}a.ShowDone()})},scope:this}}}],listeners:{},items:[{xtype:"panel",id:"resource-pickup",border:false,items:[{xtype:"box",autoEl:{tag:"div",html:_("add.chooselocation.instruction_short"),cls:"instruction"}},{xtype:"treepanel",loader:new Curriki.ui.treeLoader.Base(),id:"ctv-from-tree-cmp",useArrows:true,autoScroll:false,border:false,cls:"ctv-from-tree",animate:true,enableDrag:true,rootVisible:false,root:new Ext.tree.AsyncTreeNode({text:_("add.chooselocation.pickup_root"),id:"ctv-drag-tree-root",cls:"ctv-drag-root",leaf:false,hlColor:"93C53C",hlDrop:false,allowDrag:false,allowDrop:false,expanded:true,children:[{text:(Curriki.current.asset&&Curriki.current.asset.title)||Curriki.current.assetTitle||"UNKNOWN",id:"ctv-target-node",assetName:(Curriki.current.asset&&Curriki.current.asset.assetPage)||Curriki.current.assetName,cls:"ctv-target ctv-resource resource-"+((Curriki.current.asset&&Curriki.current.asset.assetType)||Curriki.current.assetType||"UNKNOWN"),leaf:true}]})}]},{xtype:"panel",id:"resource-drop",border:false,items:[{xtype:"treepanel",loader:new Curriki.ui.treeLoader.Base(),id:"ctv-to-tree-cmp",autoScroll:true,useArrows:true,border:false,hlColor:"93C53C",hlDrop:false,cls:"ctv-to-tree",animate:true,enableDD:true,ddScroll:true,containerScroll:true,rootVisible:false,listeners:{nodedragover:{fn:function(f){var d=f.dropNode.attributes.assetName;
var c=f.target;if(f.point!=="append"){c=c.parentNode;if(Ext.isEmpty(c)){return false
}}if(!Ext.isEmpty(c.attributes.disallowDropping)&&(c.attributes.disallowDropping===true)){f.cancel=true;
return false}var e=false;while(!Ext.isEmpty(c)&&!e){if(c.id===d){e=true;f.cancel=true;
return false}else{c=c.parentNode}}},scope:this},nodedrop:{fn:function(f){var h=Ext.getCmp("ctv-to-tree-cmp").getNodeById("ctv-target-node");
var c=h.parentNode;var e=c.id;var g=h.nextSibling;var d=-1;if(g){d=("undefined"!=typeof g.attributes.order)?g.attributes.order:-1
}Curriki.current.drop={parentPage:e,targetIndex:d};Curriki.current.parentTitle=c.text;
a.EnableNext()},scope:this},expandnode:{fn:function(d){console.log("expandnode 2");
var c=this;console.log("expandnode 2: fire afterlayout");c.fireEvent("afterlayout",c,c.getLayout());
console.log("expandnode 2: afterlayout finished")},scope:this},render:function(c){c.ownerCt.ownerCt.ownerCt.on("bodyresize",function(e,f,d){if(d==="auto"){c.setHeight("auto")
}else{c.setHeight(e.getInnerHeight()-(e.findByType("panel")[0].getBox().height+e.findByType("panel")[0].el.getMargins("tb")+e.findByType("panel")[1].getBox().height+e.items.get(1).getFrameHeight()+e.findByType("panel")[1].el.getMargins("tb")+(Ext.isIE?a.ie_size_shift:0)+(Ext.isMac?(2*a.ie_size_shift):0)))
}})}},root:new Ext.tree.AsyncTreeNode({text:_("add.chooselocation.drop_root"),id:"ctv-drop-tree-root",cls:"ctv-drop-root",leaf:false,allowDrag:false,allowDrop:false,expanded:true,children:b})}]}]}]});
a.ChooseLocation.superclass.initComponent.call(this)}});Ext.reg("apLocation",a.ChooseLocation);
a.ChooseCopyLocation=Ext.extend(Curriki.ui.dialog.Messages,{initComponent:function(){var b=[];
b.push({text:_("panels.myCurriki.myCollections"),id:"ctv-drop-tree-collection-root",cls:"ctv-top ctv-header ctv-collections",leaf:false,allowDrag:false,allowDrop:true,disallowDropping:true,expanded:false,currikiNodeType:"myCollections"});
b.push({text:_("panels.myCurriki.myGroups"),id:"ctv-drop-tree-group-root",cls:"ctv-top ctv-header ctv-groups",leaf:false,allowDrag:false,allowDrop:true,disallowDropping:true,expanded:false,currikiNodeType:"myGroups"});
Ext.apply(this,{id:"ChooseLocationDialogueWindow",title:_("add.chooselocation.copy.title"),cls:"addpath addpath-ctv resource resource-add",autoScroll:false,width:634,items:[{xtype:"panel",id:"guidingquestion-container",cls:"guidingquestion-container",items:[{xtype:"box",autoEl:{tag:"div",html:_("add.chooselocation.copy.guidingquestion",(Curriki.current.copyOfTitle||Current.copyOf||"UNKNOWN")),cls:"guidingquestion"}},{xtype:"box",autoEl:{tag:"div",html:_("add.chooselocation.copy.instruction"),cls:"instruction"}}]},{xtype:"form",id:"ChooseLocationDialoguePanel",formId:"ChooseLocationDialogueForm",labelWidth:25,autoScroll:false,border:false,defaults:{labelSeparator:""},bbar:["->",{text:_("add.chooselocation.copy.cancel.button"),id:"cancelbutton",cls:"button cancel",listeners:{click:{fn:function(){if(Ext.isEmpty(Curriki.current.drop)||confirm(_("add.chooselocation.copy.error"))){this.close();
window.location.href=Curriki.current.cameFrom}},scope:this}}},{text:_("add.chooselocation.copy.next.button"),id:"nextbutton",cls:"button next",listeners:{click:{fn:function(){if(!Ext.isEmpty(Curriki.current.drop)){Curriki.current.publishSpace=Curriki.current.drop.parentPage.replace(/\..*/,"");
Curriki.current.parentAsset=Curriki.current.drop.parentPage}else{Curriki.current.flow="Copy"
}next="apSRI1";Curriki.assets.CopyAsset(Curriki.current.copyOf,Curriki.current.publishSpace,function(c){console.log("CopyAsset CB: ",c);
Curriki.current.asset=c;callback=function(){var d=Ext.getCmp("ChooseLocationDialogueWindow");
if(d){d.close()}a.ShowNextDialogue(next)};Curriki.assets.GetMetadata(c.assetPage,function(d){Curriki.current.metadata=d;
callback()})})},scope:this}}}],listeners:{},items:[{xtype:"panel",id:"resource-pickup",border:false,items:[{xtype:"box",autoEl:{tag:"div",html:_("add.chooselocation.copy.instruction_short"),cls:"instruction"}},{xtype:"treepanel",loader:new Curriki.ui.treeLoader.Base(),id:"ctv-from-tree-cmp",useArrows:true,autoScroll:false,border:false,cls:"ctv-from-tree",animate:true,enableDrag:true,rootVisible:false,root:new Ext.tree.AsyncTreeNode({text:_("add.chooselocation.pickup_root"),id:"ctv-drag-tree-root",cls:"ctv-drag-root",leaf:false,hlColor:"93C53C",hlDrop:false,allowDrag:false,allowDrop:false,expanded:true,children:[{text:Curriki.current.copyOfTitle||"UNKNOWN",id:"ctv-target-node",assetName:Curriki.current.copyOf,cls:"ctv-target ctv-resource resource-"+(Curriki.current.copyOfAssetType||"UNKNOWN"),leaf:true}]})}]},{xtype:"panel",id:"resource-drop",border:false,items:[{xtype:"treepanel",loader:new Curriki.ui.treeLoader.Base(),id:"ctv-to-tree-cmp",autoScroll:true,useArrows:true,border:false,hlColor:"93C53C",hlDrop:false,cls:"ctv-to-tree",animate:true,enableDD:true,ddScroll:true,containerScroll:true,rootVisible:false,listeners:{nodedragover:{fn:function(f){var d=f.dropNode.attributes.assetName;
var c=f.target;if(f.point!=="append"){c=c.parentNode;if(Ext.isEmpty(c)){return false
}}if(!Ext.isEmpty(c.attributes.disallowDropping)&&(c.attributes.disallowDropping===true)){f.cancel=true;
return false}var e=false;while(!Ext.isEmpty(c)&&!e){if(c.id===d){e=true;f.cancel=true;
return false}else{c=c.parentNode}}},scope:this},nodedrop:{fn:function(f){var h=Ext.getCmp("ctv-to-tree-cmp").getNodeById("ctv-target-node");
var c=h.parentNode;var e=c.id;var g=h.nextSibling;var d=-1;if(g){d=("undefined"!=typeof g.attributes.order)?g.attributes.order:-1
}Curriki.current.drop={parentPage:e,targetIndex:d};Curriki.current.parentTitle=c.text;
a.EnableNext()},scope:this},expandnode:{fn:function(d){console.log("expandnode 3");
var c=this;c.fireEvent("afterlayout",c,c.getLayout())},scope:this},render:function(c){c.ownerCt.ownerCt.ownerCt.on("bodyresize",function(e,f,d){if(d==="auto"){c.setHeight("auto")
}else{c.setHeight(e.getInnerHeight()-(e.findByType("panel")[0].getBox().height+e.findByType("panel")[0].el.getMargins("tb")+e.findByType("panel")[1].getBox().height+e.items.get(1).getFrameHeight()+e.findByType("panel")[1].el.getMargins("tb")+(Ext.isIE?a.ie_size_shift:0)+(Ext.isMac?(2*a.ie_size_shift):0)))
}})}},root:new Ext.tree.AsyncTreeNode({text:_("add.chooselocation.drop_root"),id:"ctv-drop-tree-root",cls:"ctv-drop-root",leaf:false,allowDrag:false,allowDrop:false,expanded:true,children:b})}]}]}]});
a.ChooseCopyLocation.superclass.initComponent.call(this)}});Ext.reg("apCopyLocation",a.ChooseCopyLocation);
a.PostToTemplate=function(b){Curriki.assets.CreateAsset(Curriki.current.parentAsset,Curriki.current.publishSpace,function(c){Curriki.current.asset=c;
var d=new Ext.FormPanel({standardSubmit:true,url:b,method:"POST",onSubmit:Ext.emptyFn,submit:function(){this.getForm().getEl().dom.action=this.getForm().url;
this.getForm().getEl().dom.submit()},applyTo:Ext.getBody(),cls:"x-hide-display",items:[{xtype:"hidden",name:"pageName",value:c.assetPage},{xtype:"hidden",name:"cameFrom",value:Curriki.current.cameFrom},{xtype:"hidden",name:"flow",value:Curriki.current.flow},{xtype:"hidden",name:"parentPage",value:Curriki.current.parentAsset},{xtype:"hidden",name:"publishSpace",value:Curriki.current.publishSpace}]});
d.submit()})};a.PostFile=function(b){Curriki.assets.CreateAsset(Curriki.current.parentAsset,Curriki.current.publishSpace,function(c){Curriki.current.asset=c;
Ext.Ajax.request({url:"/xwiki/bin/upload/"+c.assetPage.replace(".","/"),isUpload:true,form:"addDialogueForm",headers:{Accept:"application/json"},callback:function(e,f,d){if(f){b(c)
}else{console.log("Upload failed",e,d);alert(_("add.servertimedout.message.text"))
}}})})};a.UploadDlg=Ext.extend(Curriki.ui.dialog.Actions,{initComponent:function(){Ext.apply(this,{title:_("add.video.uploading.dialog.title"),cls:"addpath addpath-upload resource resource-add",id:"upload-dlg",width:254,minWidth:254,items:[{xtype:"panel",html:_("add.video.uploading.dialog.sub.title")},{xtype:"progress",id:"upload-progress-bar",text:"0%"}],bbar:[{text:_("add.video.uploading.dialog.cancel.button"),id:"upload-cancel-button",cls:"button cancel btn-cancel",listeners:{click:{fn:function(){Ext.Msg.show({title:_("add.video.uploading.dialog.cancel.title"),msg:_("add.video.uploading.dialog.cancel.txt"),buttons:{ok:_("add.video.uploading.dialog.ok.button"),cancel:_("add.video.uploading.dialog.cancel.button")},fn:function(c){if(c=="yes"||c=="ok"){if(Curriki.current.videoStatusTask){Ext.TaskMgr.stop(Curriki.current.videoStatusTask)
}window.location.href=Curriki.current.cameFrom;this.close();Curriki.hideLoadingMask=false
}},closable:false,scope:this});var b=Ext.Msg.getDialog().buttons;b[0].addClass("btn-next");
b[1].addClass("btn-next");b[2].addClass("btn-cancel");b[3].addClass("btn-cancel");
Ext.Msg.getDialog().body.findParent("div.x-window-mc",2,true).setStyle("background-color","#FFFFFF")
},scope:this}}}]});a.UploadDlg.superclass.initComponent.call(this)}});Ext.reg("apUploadDlg",a.UploadDlg);
a.PostVideo=function(e,d,b){Curriki.current.videoCompleteCallback=e;if(Ext.isEmpty(d)){d="addDialogueForm"
}if(Ext.isEmpty(b)){Curriki.current.uploadCompleteCallback=function(f){Curriki.assets.CreateAsset(Curriki.current.parentAsset,Curriki.current.publishSpace,function(g){Curriki.current.asset=g;
Curriki.current.videoId=f.id;Curriki.current.videoCompleteCallback(g)})}}else{Curriki.current.uploadCompleteCallback=b
}Curriki.current.uuid=Math.uuid(21);Curriki.hideLoadingMask=true;Curriki.current.uploading=true;
Curriki.current.vu_last_update=0;Curriki.ui.show("apUploadDlg");Ext.Ajax.request({url:"http://"+_("MEDIAHOST")+"/media/upload?key="+Curriki.current.uuid,isUpload:true,form:d,headers:{Accept:"text/html"},callback:function(g,h,f){if(h){}else{console.log("Upload failed",g,f);
alert(_("add.servertimedout.message.text"))}}});Curriki.current.videoStatusRequest=function(){Ext.ux.JSONP.request("http://"+_("MEDIAHOST")+"/media/uploadStatus",{callbackKey:"callback",params:{key:Curriki.current.uuid,r:Math.uuid(21)},callback:Curriki.current.videoJsonCallback})
};Curriki.current.videoSuccessCallback=function(f){Curriki.current.uploadCompleteCallback(f)
};Curriki.current.videoErrorCallback=function(f){console.log("Video Upload Error",f);
Ext.Msg.alert(_("add.video.cannot.process.title"),_("add.video.cannot.process.txt",_(f.msg)));
var g=Ext.Msg.getDialog().buttons;g[0].addClass("btn-next");g[1].addClass("btn-next");
g[2].addClass("btn-cancel");g[3].addClass("btn-cancel");Ext.Msg.getDialog().body.findParent("div.x-window-mc",2,true).setStyle("background-color","#FFFFFF")
};Curriki.current.videoJsonCallback=function(j){if(!Curriki.current.uploading){return
}if(console){console.log("Complete? "+j.complete+", Error? "+j.error)}if(j.complete){if(j.error||j.success){Curriki.current.uploading=false;
Ext.TaskMgr.stop(Curriki.current.videoStatusTask);Curriki.hideLoadingMask=false;Ext.getCmp("upload-dlg").hide();
if(j.error){Curriki.current.videoErrorCallback(j.error);return}else{if(j.success){Curriki.current.videoSuccessCallback(j.success);
return}}}}else{var f=new Date().getTime();if(f<Curriki.current.vu_last_update){return
}Curriki.current.vu_last_update=f;var k=j.current||0;var h=j.total||0;var g=0;var l="%";
if(h&&k){g=k/h}l=Math.floor(g*100)+"%";Ext.getCmp("upload-progress-bar").updateProgress(g,l)
}};var c={run:Curriki.current.videoStatusRequest,interval:3000};Curriki.current.videoStatusTask=Ext.TaskMgr.start(c)
};a.AddSubasset=function(b){Curriki.assets.CreateSubasset(Curriki.current.drop.parentPage,(Curriki.current.asset&&Curriki.current.asset.assetPage)||Curriki.current.assetName,Curriki.current.drop.targetIndex,function(){if("function"===typeof b){b()
}})};a.AddFavorite=function(b){Curriki.assets.CreateSubasset("Coll_"+Curriki.data.user.me.username.replace("XWiki.","")+".Favorites",Curriki.current.assetName,-1,function(){if("function"===typeof b){b()
}})};a.ShowNextDialogue=function(c,e){var d=Ext.ComponentMgr.create({xtype:c});d.show();
Ext.ComponentMgr.register(d);if(!Ext.isEmpty(e)){var b=Ext.getCmp(e);if(b){b.close()
}}};a.SourceSelected=function(g,b){Curriki.current.selected=g;var f;switch(g){case"file":Curriki.current.fileName=b.filename;
f="apSRI1";a.PostFile(function(h){callback=function(){a.ShowNextDialogue(f,a.AddSourceDialogueId)
};Curriki.assets.GetMetadata(h.assetPage||Curriki.current.asset.assetPage,function(j){Curriki.current.metadata=j;
callback()})});return;break;case"video_upload":f="apSRI1";var d="asf|avi|wma|wmv|flv|mov|movie|qt|mp4|mpg|mpeg|3gp|m4v|f4v|webm";
var e=new RegExp("^.+\\.("+d+")$","i");var c=Ext.getCmp("video_upload-entry-box").getValue();
if(!e.test(c)){if(!confirm(_("add.video.uploading.unknown.file.txt"))){return false
}}a.PostVideo(function(h){console.log("CreateAsset (video) CB: ",h);Curriki.current.asset=h;
Curriki.assets.CreateVIDITalk(h.assetPage,Curriki.current.videoId,function(j){console.log("Created viditalk CB: ",j);
callback=function(){a.ShowNextDialogue(f,a.AddSourceDialogueId)};Curriki.assets.GetMetadata(h.assetPage,function(k){Curriki.current.metadata=k;
callback()})})});return;break;case"link":Curriki.current.linkUrl=b.link;f="apSRI1";
Curriki.assets.CreateAsset(Curriki.current.parentAsset,Curriki.current.publishSpace,function(h){console.log("CreateAsset (link) CB: ",h);
Curriki.current.asset=h;Curriki.assets.CreateExternal(h.assetPage,Curriki.current.linkUrl,function(j){console.log("Created Link CB: ",j);
callback=function(){a.ShowNextDialogue(f,a.AddSourceDialogueId)};Curriki.assets.GetMetadata(h.assetPage,function(k){Curriki.current.metadata=k;
callback()})})});return;break;case"template":Curriki.current.templateType="template";
if(a.TemplateList().size()>1){f="apSelectTemplate"}else{a.PostToTemplate(_("add.selecttemplate.list1.url"));
return}break;case"scratch":Curriki.current.templateType="format";if(a.TemplateList().size()>1){f="apSelectTemplate"
}else{a.PostToTemplate(_("add.selectformat.list1.url"));return}break;case"folder":f="apSRI1";
Curriki.assets.CreateAsset(Curriki.current.parentAsset,Curriki.current.publishSpace,function(h){console.log("CreateAsset (folder) CB: ",h);
Curriki.current.asset=h;Curriki.assets.CreateFolder(h.assetPage,function(j){console.log("Created Folder CB: ",j);
Curriki.current.flowFolder="Folder";callback=function(){a.ShowNextDialogue(f,a.AddSourceDialogueId)
};Curriki.assets.GetMetadata(h.assetPage,function(k){Curriki.current.metadata=k;callback()
})})});return;break;case"collection":f="apSRI1";Curriki.assets.CreateAsset(Curriki.current.parentAsset,Curriki.current.publishSpace,function(h){console.log("CreateAsset (collection) CB: ",h);
Curriki.current.asset=h;Curriki.assets.CreateCollection(h.assetPage,function(j){console.log("Created Collection CB: ",j);
callback=function(){a.ShowNextDialogue(f)};Curriki.assets.GetMetadata(h.assetPage,function(k){Curriki.current.metadata=k;
callback()})})});return;break;case"toFavorites":a.AddFavorite(function(){Curriki.logView("/features/resources/favorites/"+Curriki.current.assetName.replace(".","/"));
a.ShowDone()});return;break;case"copy":if(true||Curriki.data.user.collectionChildren.length>0||Curriki.data.user.groupChildren.length>0){Curriki.current.flow="Copy2";
f="apCopyLocation";a.ShowNextDialogue(f)}else{f="apSRI1";Curriki.assets.CopyAsset(Curriki.current.copyOf,Curriki.current.publishSpace,function(h){console.log("CopyAsset CB: ",h);
Curriki.current.asset=h;callback=function(){a.ShowNextDialogue(f)};Curriki.assets.GetMetadata(h.assetPage,function(j){Curriki.current.metadata=j;
callback()})})}return;break;default:f="apSRI1";break}if(!Ext.isEmpty(f)){a.ShowNextDialogue(f,a.AddSourceDialogueId)
}};a.start=function(e){console.log("Starting path: ",e);if(Ext.isEmpty(Curriki.data.user.me)||"XWiki.XWikiGuest"===Curriki.data.user.me.username){console.log("Not signed in:");
window.location.href="/xwiki/bin/login/XWiki/XWikiLogin?xredirect="+window.location.href;
return}if(Ext.isEmpty(Curriki.current.cameFrom)){Curriki.current.cameFrom=window.location.href
}if(!Ext.isEmpty(Curriki.current.parentAsset)&&(Curriki.current.parentAsset.substr(0,5)==="Coll_")){var d=Curriki.current.parentAsset.replace(/\..*$/,"");
Curriki.current.publishSpace=d}if(Ext.isEmpty(Curriki.current.publishSpace)){Curriki.current.publishSpace="Coll_"+Curriki.data.user.me.username.replace(/XWiki\./,"")
}if(!Ext.isEmpty(e)){Curriki.current.flow=e}var b=window.location.pathname.split("/");
var c=b.size();Curriki.current.subPath="";for(i=c-2;i<c;i++){Curriki.current.subPath+="/"+b[i]
}Curriki.logView("/features/resources/add/"+Curriki.current.flow+Curriki.current.subPath);
switch(Curriki.current.flow){case"B":case"I":case"O":Curriki.ui.show("apSource");
return;break;case"D":Curriki.current.flow="B";Curriki.ui.show("apSource");return;
break;case"D1":Curriki.current.flow="D";a.SourceSelected("scratch",{});return;break;
case"D2":Curriki.current.flow="R";a.SourceSelected("template",{});return;break;case"C":case"K":case"M":a.SourceSelected("collection",{});
return;break;case"E":case"H":case"J":case"P":console.log("Starting path:",Curriki.current.flow);
Curriki.ui.show("apLocation");return;break;case"G":a.SourceSelected("toFavorites",{});
return;break;case"F":case"L":case"N":Curriki.ui.show("apSource",{toFolder:true,folderName:Curriki.current.parentTitle});
return;break;case"R":a.SourceSelected("template",{});return;break;case"Copy":a.SourceSelected("copy",{});
return;break}};Curriki.module.addpath.initialized=true}};Curriki.module.addpath.startPath=function(b,a){Curriki.module.addpath.initAndStart(function(){Curriki.module.addpath.start(b)
},a)};Curriki.module.addpath.startDoneMessage=function(a){Curriki.module.addpath.initAndStart(function(){Curriki.module.addpath.ShowDone()
},a)};Curriki.module.addpath.initAndStart=function(c,a){var b=Curriki.current;if(!Ext.isEmpty(a)){b.assetName=a.assetName||b.assetName;
b.parentAsset=a.parentAsset||b.parentAsset;b.publishSpace=a.publishSpace||b.publishSpace;
b.copyOf=a.copyOf||b.copyOf;b.cameFrom=a.cameFrom||b.cameFrom;b.assetTitle=a.assetTitle||b.assetTitle;
b.assetType=a.assetType||b.assetType;b.parentTitle=a.parentTitle||b.parentTitle;b.copyOfTitle=a.copyOfTitle||b.copyOfTitle;
b.copyOfAssetType=a.copyOfAssetType||b.copyOfAssetType}Ext.ns("Curriki.settings");
Curriki.settings.localCollectionFetch=true;Curriki.init(function(){if(Ext.isEmpty(Curriki.data.user.me)||"XWiki.XWikiGuest"===Curriki.data.user.me.username){window.location.href="/xwiki/bin/login/XWiki/XWikiLogin?xredirect="+window.location.href;
return}Curriki.module.addpath.init();var g=function(){c()};var e;if(!Ext.isEmpty(b.parentAsset)&&Ext.isEmpty(b.parentTitle)){e=function(){Curriki.assets.GetAssetInfo(b.parentAsset,function(h){Curriki.current.parentTitle=h.title;
g()})}}else{e=function(){g()}}var d;if(!Ext.isEmpty(b.copyOf)&&(Ext.isEmpty(b.copyOfTitle)||Ext.isEmpty(b.copyOfAssetType))){d=function(){Curriki.assets.GetAssetInfo(b.copyOf,function(h){Curriki.current.copyOfTitle=h.title;
Curriki.current.copyOfAssetType=h.assetType;e()})}}else{d=function(){e()}}var f;if(!Ext.isEmpty(b.assetName)&&(Ext.isEmpty(b.assetTitle)||Ext.isEmpty(b.assetType))){f=function(){Curriki.assets.GetAssetInfo(b.assetName,function(h){Curriki.current.assetTitle=h.title;
Curriki.current.assetType=h.assetType;d()})}}else{f=function(){d()}}f()})};Curriki.module.addpath.loaded=true;
Ext.ns("Curriki.current");Curriki.current={init:function(){Ext.apply(this,{assetName:null,parentAsset:null,publishSpace:null,copyOf:null,cameFrom:null,flow:null,flowFolder:"",assetTitle:null,assetType:null,parentTitle:null,copyOfTitle:null,copyOfAssetType:null,asset:null,metadata:null,selected:null,fileName:null,uuid:null,videoId:null,linkUrl:null,sri1:null,sri1fillin:null,sri2fillin:null,submitToTemplate:null,templateType:null,drop:null})
}};Curriki.current.init();