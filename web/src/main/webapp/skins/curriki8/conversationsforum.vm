  ## Import styles & scripts
  #template('conversationssetup.vm')
  ## Import vars
  #template('conversationsvars.vm')
  ## Import macros
  #template('conversationsmacros.vm')
  #set($topics = $xwiki.searchDocuments(', BaseObject as obj where doc.parent = ? and obj.name = doc.fullName and obj.className = ?', 0, 0, [$doc.fullName, 'ConversationCode.TopicClass']))
  ## Count comments
  #set($comments = 0)
  #foreach($topic in $topics)
    #set($topicAnswers = $xwiki.searchDocuments(', BaseObject obj where doc.parent = ? and doc.fullName = obj.name and obj.className = ? and doc.fullName != ? order by doc.date desc', 0, 0, [$topic, 'ConversationCode.AnswerClass', 'ConversationCode.AnswerTemplate']))
    #foreach($topicAnswer in $topicAnswers)
      #set($answerDoc = $xwiki.getDocument($topicAnswer))
      #set($comments = $comments + $answerDoc.getComments().size())
    #end
  #end

  ## Display forum shortcuts (edit / like / nb of comments)
  <div>  
    <span class="commenttools forum">                  
      #if($xwiki.hasAccessLevel('edit', $xcontext.user, $doc.prefixedFullName))
        <span class="commenttool commentedit"><a class="edit" href="$doc.getURL('edit')" title="$msg.get('conversations.forum.edit')">$msg.get('conversations.forum.edit')</a></span>
      #end
      <span class="separator">&nbsp;|&nbsp;</span>
      <span class="conversation-ratings">
        <span class="conversation-like">
          <input type="hidden" name="documenttolike" value="$doc.fullName" />
          <img src="$escapetool.xml($xwiki.getDocument('ConversationCode.TopicSheet').getAttachmentURL('conversation-like.png'))" alt="$escapetool.xml($msg.get('conversation.like.button'))" #if($xwiki.ratings.getRating($doc, $xcontext.user) == $util.null)class="canVote" title="$msg.get('conversation.like.button.tooltip')"#else title="$msg.get('conversation.like.button.alreadyliked.tooltip')"#end />
        </span>
        #set($rating = $xwiki.ratings.getAverageRating($doc).nbVotes)
        <span class="conversation-score" title="$msg.get('conversation.like.score.tooltip', [$rating])">$rating</span>
      </span>
      <span class="separator">&nbsp;|&nbsp;</span>
      <span class="conversation-topic">$topics.size()</span> 
      <span class="separator">&nbsp;|&nbsp;</span>
      <span class="conversation-comments">$!comments</span>       
    </span>## commenttools
  </div>
  ## Display forum title and description
  <div id="document-title" class="conversation-title"><h1>$doc.displayTitle</h1></div>
  <div class="forum-description">$doc.display('description')</div>
  ## Display topic add form
  #displayTopicAddForm()
  ## Display topic list
  #displayTopics()
  #displayEditors()
